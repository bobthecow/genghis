(function(){var t,e,n,i,r,s,o,a,l,u,p=function(t,e){return function(){return t.apply(e,arguments)}},h={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)h.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f=[].slice;if(t=window.$,o=window._,i=window.Backbone,!o&&(o="function"==typeof require?require("underscore"):void 0,!o))throw Error("Can't find underscore");if(!i&&(i="function"==typeof require?require("backbone"):void 0,!i))throw Error("Can't find Backbone");i.Giraffe=window.Giraffe=r={version:"0.2.4",app:null,apps:{},views:{}},n=t(window),e=t(document),s=function(){var t,e;return"undefined"!=typeof console&&null!==console?null!=(t=console.error)?t.apply(console,(e=["Backbone.Giraffe error:"]).concat.apply(e,arguments)):void 0:void 0},r.View=function(n){function i(t){this.render=p(this.render,this),r.configure(this,t),this.children=[],this.parent=null,this._renderedOnce=!1,this._isAttached=!1,this._createEventsFromUIElements(),"string"==typeof this.templateStrategy&&r.View.setTemplateStrategy(this.templateStrategy,this),i.__super__.constructor.apply(this,arguments)}return c(i,n),i.defaultOptions={disposeOnDetach:!0},i.prototype.beforeInitialize=function(){return this._cache(),this.$el.attr("data-view-cid",this.cid),this.setParent(r.View.getClosestView(this.$el)),this._cacheUiElements()},i.prototype._attachMethods=["append","prepend","html","after","before","insertAfter","insertBefore"],i.prototype._siblingAttachMethods=["after","before","insertAfter","insertBefore"],i.prototype.attachTo=function(t,e){var n,i,a,l,u,p;return l=(null!=e?e.method:void 0)||"append",a=(null!=e?e.forceRender:void 0)||!1,p=(null!=e?e.suppressRender:void 0)||!1,this.$el?(o.contains(this._attachMethods,l)||(s("The attach method '"+l+"' isn't supported. Defaulting to 'append'.",l,this._attachMethods),l="append"),i=r.View.to$El(t),1!==i.length?(s("Expected to render to a single element but found "+i.length,t),this):(this.trigger("attaching",this,i,e),n=o.contains(this._siblingAttachMethods,l)?i.parent():i,"insertAfter"===l&&(l="after"),"insertBefore"===l&&(l="before"),this.detach(!0),this.setParent(r.View.getClosestView(n)),"html"===l&&(r.View.detachByEl(i),i.empty()),i[l](this.$el),this._isAttached=!0,u=!p&&(!this._renderedOnce||a||this.alwaysRender),u&&this.render(e),this.saveScrollPosition&&this._loadScrollPosition(),null!=this.documentTitle&&(document.title=this.documentTitle),this.trigger("attached",this,i,e),this)):(s("Trying to attach a disposed view. Make a new one or create the view with the option `disposeOnDetach` set to false.",this),this)},i.prototype.attach=function(t,e){var n,i;if(i=null,null!=e?e.el:void 0){if(n=r.View.to$El(e.el,this.$el,!0),!n.length)return s("Attempting to attach to an element that doesn't exist inside this view!",e,t,this),this;i=n}else i=this.$el;return t.attachTo(i,e),this},i.prototype.render=function(t){var e;return this.trigger("rendering",this,t),this.beforeRender.apply(this,arguments),this._renderedOnce=!0,this.detachChildren(null!=t?t.preserve:void 0),e=this.templateStrategy.apply(this,arguments)||"",this.$el.empty()[0].innerHTML=e,this._cacheUiElements(),this.afterRender.apply(this,arguments),this.trigger("rendered",this,t),this},i.prototype.beforeRender=function(){},i.prototype.afterRender=function(){},i.prototype.templateStrategy=function(){return""},i.prototype.template=null,i.prototype.serialize=function(){return this},i.prototype.detach=function(t){return null==t&&(t=!1),this._isAttached?(this._isAttached=!1,this.saveScrollPosition&&this._saveScrollPosition(),this.trigger("detaching",this,t),this.$el.detach(),this.trigger("detached",this,t),this.disposeOnDetach&&!t&&this.dispose(),this):this},i.prototype.detachChildren=function(t){var e,n,i,r;for(null==t&&(t=!1),r=this.children.slice(),n=0,i=r.length;i>n;n++)e=r[n],"function"==typeof e.detach&&e.detach(t);return this},i.prototype._saveScrollPosition=function(){return this._scrollPosition=this._getScrollPositionEl().scrollTop(),this},i.prototype._loadScrollPosition=function(){return null!=this._scrollPosition&&this._getScrollPositionEl().scrollTop(this._scrollPosition),this},i.prototype._getScrollPositionEl=function(){var t;return"boolean"==typeof this.saveScrollPosition||this.$el.is(this.saveScrollPosition)?this.$el:(t=r.View.to$El(this.saveScrollPosition,this.$el).first(),t.length?t:(t=r.View.to$El(this.saveScrollPosition).first(),t.length?t:this.$el))},i.prototype.addChild=function(t){var e;return o.contains(this.children,t)||(null!=(e=t.parent)&&e.removeChild(t,!0),t.parent=this,this.children.push(t)),this},i.prototype.addChildren=function(t){var e,n,i;for(n=0,i=t.length;i>n;n++)e=t[n],this.addChild(e);return this},i.prototype.removeChild=function(t,e){var n;return null==e&&(e=!1),n=o.indexOf(this.children,t),-1!==n&&(this.children.splice(n,1),t.parent=null,e?"function"==typeof t.detach&&t.detach(!0):"function"==typeof t.dispose&&t.dispose()),this},i.prototype.removeChildren=function(t){var e,n,i,r;for(null==t&&(t=!1),r=this.children.slice(),n=0,i=r.length;i>n;n++)e=r[n],this.removeChild(e,t);return this},i.prototype.setParent=function(t){return t&&t!==this?t.addChild(this):this.parent&&(this.parent.removeChild(this,!0),this.parent=null),this},i.prototype.isAttached=function(t){return null!=t?t.$el?!!t.$el.find(this.$el).length:this.$el.parent().is(t):!!e.find(this.$el).length},i.prototype.ui=null,i.prototype._cacheUiElements=function(){var t,e,n;if(this.ui){n=this.ui;for(t in n)e=n[t],this[t]=function(){switch(typeof e){case"string":return this.$(e);case"function":return e.call(this);default:return e}}.call(this)}return this},i.prototype._uncacheUiElements=function(){var t;if(this.ui)for(t in this.ui)delete this[t];return this},i.prototype._createEventsFromUIElements=function(){var t,e,n,i;if(!this.events||!this.ui)return this;"function"==typeof this.ui&&(this.ui=this.ui.call(this)),"function"==typeof this.events&&(this.events=this.events.call(this)),i=this.events;for(t in i)e=i[t],n=this._getEventKeyFromUIElements(t),n!==t&&(delete this.events[t],this.events[n]=e);return this},i.prototype._getEventKeyFromUIElements=function(t){var e,n,i,r;return i=t.split(" "),n=i.length,2>n?t:(e=i[n-1],r=this.ui[e],r?(i[n-1]=r,i.join(" ")):t)},i.prototype.dataEvents=null,i.prototype._uncache=function(){return delete r.views[this.cid],this},i.prototype._cache=function(){return r.views[this.cid]=this,this},i.prototype.invoke=function(){var t,e,n;for(e=arguments[0],t=arguments.length>=2?f.call(arguments,1):[],n=this;n&&!n[e];)n=n.parent;return(null!=n?n[e]:void 0)?n[e].apply(n,t):(s("No such method name in view hierarchy",e,t,this),!1)},i.prototype.appEvents=null,i.prototype.beforeDispose=function(){return this.setParent(null),this.removeChildren(),this._uncacheUiElements(),this._uncache(),this._isAttached=!1,this.$el?(this.remove(),this.$el=null):s("Disposed of a view that has already been disposed",this),this},i.detachByEl=function(t,e){var n,i,s,o;for(null==e&&(e=!1),i=r.View.to$El(t);(n=i.find("[data-view-cid]:first")).length;)s=n.attr("data-view-cid"),o=r.View.getByCid(s),o.detach(e);return this},i.getClosestView=function(t){var e,n;return e=r.View.to$El(t),n=e.closest("[data-view-cid]").attr("data-view-cid"),r.View.getByCid(n)},i.getByCid=function(t){return r.views[t]},i.to$El=function(e,n,i){var s;return null==i&&(i=!1),n?(s=r.View.to$El(n),(null!=e?e.$el:void 0)&&(e=e.$el),i&&s.is(e)?s:s.find(e)):(null!=e?e.$el:void 0)?e.$el:e instanceof t?e:t(e)},i.setDocumentEvents=function(n,i){var s,a,l,u,p,h;for(null==i&&(i=r.View._documentEventPrefix),i=i||"","string"==typeof n&&(n=n.split(" ")),o.isArray(n)||(n=[n]),n=o.compact(n),r.View.removeDocumentEvents(),r.View._currentDocumentEvents=n,r.View._documentEventPrefix=i,u=function(n,i,s){return e.on(n,s,function(e){var n,o,a;return n=t(e.target).closest(s),o=n.attr(i),a=r.View.getClosestView(n),a.invoke(o,e)})},p=0,h=n.length;h>p;p++)a=n[p],s=i+a,l="["+s+"]",u(a,s,l);return n},i.removeDocumentEvents=function(t){var n,i,s,o,a;if(null==t&&(t=r.View._documentEventPrefix),t=t||"",n=r.View._currentDocumentEvents,null!=n?n.length:void 0){for(o=0,a=n.length;a>o;o++)i=n[o],s="["+t+i+"]",e.off(i,s);return r.View._currentDocumentEvents=null}},i.setDocumentEventPrefix=function(t){return null==t&&(t=""),r.View.setDocumentEvents(r.View._currentDocumentEvents,t)},i.setTemplateStrategy=function(e,n){var i,a;if(i=typeof e,"function"===i)a=e;else{if("string"!==i)return s("Unrecognized template strategy",e);switch(e.toLowerCase()){case"underscore-template-selector":a=function(){var e,n=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":e=this.template,this._templateFn=o.template(t(e).html()||"");break;case"function":this._templateFn=function(i){return e=n.template(),o.template(t(e).html()||"",i)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"underscore-template":a=function(){var t=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":this._templateFn=o.template(this.template);break;case"function":this._templateFn=function(e){return o.template(t.template(),e)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"jst":a=function(){var t;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":t=this.template,this._templateFn=function(){return t};break;case"function":this._templateFn=this.template;break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;default:throw Error("Unrecognized template strategy: "+e)}}return n?n.templateStrategy=a:r.View.prototype.templateStrategy=a},i}(i.View),r.View.setTemplateStrategy("underscore-template-selector"),r.View.setDocumentEvents(["click","change"],"data-gf-"),r.App=function(t){function e(){this._onUnload=p(this._onUnload,this),this.app=this,this._initializers=[],this.started=!1,e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype._cache=function(){return null==r.app&&(r.app=this),r.apps[this.cid]=this,this.routes&&null==this.router&&(this.router=new r.Router({app:this,triggers:this.routes})),n.on("unload",this._onUnload),e.__super__._cache.apply(this,arguments)},e.prototype._uncache=function(){return r.app===this&&(r.app=null),delete r.apps[this.cid],this.router&&(this.router=null),n.off("unload",this._onUnload),e.__super__._uncache.apply(this,arguments)},e.prototype._onUnload=function(){return this.dispose()},e.prototype.appEvents=null,e.prototype.routes=null,e.prototype.addInitializer=function(t){return this.started?(t.call(this,this._startOptions),o.extend(this,this._startOptions)):this._initializers.push(t),this},e.prototype.start=function(t){var e,n=this;return null==t&&(t={}),this._startOptions=t,this.trigger("app:initializing",t),e=function(i){var r;return i?s(i):(r=n._initializers.shift(),r?2===r.length?r.call(n,t,e):(r.call(n,t),e()):(o.extend(n,t),n.started=!0,n.trigger("app:initialized",t)))},e(),this},e}(r.View),r.Router=function(t){function e(t){return r.configure(this,t),this.app?(this.app.addChild(this),"function"==typeof this.triggers&&(this.triggers=this.triggers.call(this)),this.triggers?(this._routes={},this._bindTriggers(),e.__super__.constructor.apply(this,arguments),void 0):s("Giraffe routers require a `triggers` map of routes to app events.")):s("Giraffe routers require an app! Please create an instance of Giraffe.App before creating a router.")}return c(e,t),e.prototype.namespace="",e.prototype._fullNamespace=function(){return this.parentRouter?this.parentRouter._fullNamespace()+"/"+this.namespace:this.namespace},e.prototype.triggers=null,e.prototype._bindTriggers=function(){var t,e,n,i,r,o=this;this.triggers||s("Expected router to implement `triggers` hash in the form {route: appEvent}"),e=this._fullNamespace(),e.length>0&&(e+="/"),r=this.triggers,i=function(t,e,n){var i;return 0===e.indexOf("-> ")?i=function(){var t;return t=e.slice(3),o.navigate(t,{trigger:!0})}:0===e.indexOf("=> ")?i=function(){var t;return t=e.slice(3),o.navigate(n+t,{trigger:!0})}:(t=n+t,i=function(){var n,i;return n=arguments.length>=1?f.call(arguments,0):[],(i=o.app).trigger.apply(i,[e].concat(f.call(n),[t]))},o._registerRoute(e,t)),o.route(t,e,i)};for(n in r)t=r[n],i(n,t,e);return this},e.prototype._unbindTriggers=function(){var t;return t=this._getTriggerRegExpStrings(),i.history.handlers=o.reject(i.history.handlers,function(e){return o.contains(t,""+e.route)})},e.prototype._getTriggerRegExpStrings=function(){return o.map(o.keys(this.triggers),function(t){return""+i.Router.prototype._routeToRegExp(t)})},e.prototype.cause=function(){var t,e,n,r,s;return e=arguments[0],t=arguments.length>=2?f.call(arguments,1):[],r=this.getRoute.apply(this,[e].concat(f.call(t))),null!=r?(n=t[t.length-1],i.history.navigate(r,o.extend({trigger:!0},o.isObject(n)?n:{}))):(s=this.app).trigger.apply(s,[e].concat(f.call(t)))},e.prototype.isCaused=function(){var t,e,n;return e=arguments[0],t=arguments.length>=2?f.call(arguments,1):[],n=this.getRoute.apply(this,[e].concat(f.call(t))),null!=n?this._getLocation()===n:!1},e.prototype._getLocation=function(){return i.history._hasPushState?window.location.pathname.slice(1):window.location.hash},e.prototype.getRoute=function(){var t,e,n;return e=arguments[0],t=arguments.length>=2?f.call(arguments,1):[],n=this._routes[e],null!=n?(n=this._reverseHash.apply(this,[n].concat(f.call(t))),n?i.history._hasPushState?n:"#"+n:""===n?"":null):null},e.prototype._registerRoute=function(t,e){return this._routes[t]=e},e.prototype._reverseHash=function(){var t,e,n,i,r;return i=arguments[0],t=arguments.length>=2?f.call(arguments,1):[],e=t[0],null==e?i:(r=/:\w+|\*\w+/g,n=o.isObject(e)?i.replace(r,function(t){var n,i;return n=t.slice(1),null!=(i=e[n])?i:""}):i.replace(r,function(){var e;return e=t.shift(),null!=e?e:""}))},e.prototype.reload=function(t){return t&&(i.history.stop(),window.location=t),window.location.reload()},e.prototype.appEvents=null,e.prototype.beforeDispose=function(){return this._unbindTriggers()},e}(i.Router),r.Model=function(t){function e(t,n){r.configure(this,n),e.__super__.constructor.apply(this,arguments)}return c(e,t),e.defaultOptions={omittedOptions:"parse"},e.prototype.appEvents=null,e.prototype.beforeDispose=function(){var t;return this._disposed=!0,null!=(t=this.collection)?t.remove(this):void 0},e}(i.Model),r.Collection=function(t){function e(t,n){r.configure(this,n),e.__super__.constructor.apply(this,arguments)}return c(e,t),e.defaultOptions={omittedOptions:"parse"},e.prototype.model=r.Model,e.prototype.appEvents=null,e.prototype.beforeDispose=function(){var t,e,n,i;for(i=this.models.slice(),e=0,n=i.length;n>e;e++)t=i[e],t.dispose();return this},e.prototype._removeReference=function(t){return e.__super__._removeReference.apply(this,arguments),t._disposed?void 0:"function"==typeof t.dispose?t.dispose():void 0},e}(i.Collection),r.configure=function(t,e){var n,i,l,u;return t?(i=o.extend({},r.defaultOptions,null!=(l=t.constructor)?l.defaultOptions:void 0,t.defaultOptions,e),n=null!=(u=i.omittedOptions)?u:t.omittedOptions,n!==!0&&o.extend(t,o.omit(i,n)),null==t.dispose&&(t.dispose=r.dispose),null==t.app&&(t.app=r.app),t.appEvents&&r.bindAppEvents(t),t.initialize?r.wrapFn(t,"initialize",null,a):a.call(t),t):(s("Cannot configure obj",t),!1)},r.defaultOptions={},a=function(){return this.dataEvents?r.bindDataEvents(this):void 0},r.dispose=function(){var t;return t=arguments.length>=1?f.call(arguments,0):[],"function"==typeof this.trigger&&this.trigger.apply(this,["disposing",this].concat(f.call(t))),"function"==typeof this.beforeDispose&&this.beforeDispose.apply(this,t),this.app=null,"function"==typeof this.stopListening&&this.stopListening(),"function"==typeof this.trigger&&this.trigger.apply(this,["disposed",this].concat(f.call(t))),"function"==typeof this.afterDispose&&this.afterDispose.apply(this,t),this},r.bindAppEvents=function(t){return r.bindEventMap(t,t.app,t.appEvents)},r.bindDataEvents=function(t){var e,n,i,o,a,l;if(n=t.dataEvents){"function"==typeof n&&(n=t.dataEvents());for(i in n)e=n[i],a=i.split(" "),2>a.length?s("Data event must specify target object, ex: {'change collection': 'handler'}"):(l=a.pop(),l="this"===l||"@"===l?t:t[l],l?(o=a.join(" "),r.bindEvent(t,l,o,e)):s("Target object not found for data event '"+i+"'",t));return t}},r.bindEvent=function(){var t;return t=arguments.length>=1?f.call(arguments,0):[],t.push("listenTo"),l.apply(null,t)},r.unbindEvent=function(){var t;return t=arguments.length>=1?f.call(arguments,0):[],t.push("stopListening"),l.apply(null,t)},r.bindEventMap=function(){var t;return t=arguments.length>=1?f.call(arguments,0):[],t.push("listenTo"),u.apply(null,t)},r.unbindEventMap=function(){var t;return t=arguments.length>=1?f.call(arguments,0):[],t.push("stopListening"),u.apply(null,t)},l=function(t,e,n,i,r){return"string"==typeof i&&(i=t[i]),"function"!=typeof i?(s("callback for `'"+n+"'` not found",t,e,i),void 0):t[r](e,n,i)},u=function(t,e,n,i){var r,s;if("function"==typeof n&&(n=n.call(t)),n){for(s in n)r=n[s],l(t,e,s,r,i);return t}},r.wrapFn=function(t,e,n,i){var r,s;return s=t[e],"function"==typeof s?(r=e[0].toUpperCase()+e.slice(1),t[e]=function(){var e,o,a,l;return e=arguments.length>=1?f.call(arguments,0):[],null!=n&&n.apply(t,e),"function"==typeof t[a="before"+r]&&t[a].apply(t,e),o=s.apply(t,e),"function"==typeof t[l="after"+r]&&t[l].apply(t,e),null!=i&&i.apply(t,e),o}):void 0},o.isObject("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=r:"function"==typeof define&&define.amd&&define("backbone.giraffe",[],function(){return r})}).call(this);